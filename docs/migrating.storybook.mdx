import { Meta } from '@storybook/blocks';

import { PlacementMappingsTable } from './components/PlacementMappingsTable';

<Meta title="Migrating" />

# Migrating

Migrate to the next Wave major version with ease.

## Codemods

Codemods are scripted transformations that you can run on your code to take care of most of the repetitive work involved
in upgrading from one major version to the next. The codemod instructions for each major release assume that your code
has already been upgraded to the previous major release. If this is not the case, you should run the codemods for all
previous major versions first. Beware that codemods are not 100% fool-proof and may break your code.

If you're working in a typescript environment, you need to add `--parser=tsx` to the command in each codemod command to
allow jscodeshift to parse your typescript/jsx files.

## From v1 to v2

Run all migrations at once:

```bash
# npm
npx @freenow/wave run_v2_migration src/**/*

# yarn
yarn exec node_modules/.bin/run_v2_migration src/**/*

```

Below, you'll see individual codemods to upgrade components to version 2.
In order to apply an individual transformation to your project
you need to run the command for your desired codemod pointing to your project's source path.

### Button and TextButton block property

The `block` property used to act as a shortcut to give the button components a width of 100%. In the future, use the `width` property
directly. It uses the styled-system variable, which is a lot more flexible than just the boolean flag.

```bash
npx jscodeshift --parser=tsx --extension=js,jsx,ts,tsx -t node_modules/@freenow/wave/lib/cjs/codemods/block-to-width-100.js path/to/src
```

### Colors to CSS variables

Our theme colors structure has changed significantly in this major. In order to use Wave colors in your project you should now use the CSS variables
that our theme brings.

```bash
npx jscodeshift --parser=tsx --extension=js,jsx,ts,tsx -t node_modules/@freenow/wave/lib/cjs/codemods/colors-to-css-vars.js path/to/src
```

Disclaimer: This codemod transforms usages of `Colors` to our bare colors CSS variables to ensure we don't introduce breaking changes, that being said,
we recommend using semantic tokens instead as a best practice and offer a `getSemanticValue` API for just that.

### Deprecated icons

We had some deprecated icons that have been deleted in this major, in case you used any of them you need to use their valid (non-deprecated) counterpart from now on.
This won't change how your icons look in any way since we already exported the deprecated icons as wrappers of valid ones.

```bash
npx jscodeshift --parser=tsx --extension=js,jsx,ts,tsx -t node_modules/@freenow/wave/lib/cjs/codemods/deprecated-icons.js path/to/src
```

### Inverted property deprecation

With the introduction of our new dark theme in Wave we've removed the `inverted` property that several components had. In case you want a specific component to have
the styling of the opposite theme you need to wrap it with the `InvertedColorScheme` component.

The components that supported the `inverted` prop are: `Input`, `Password`, `Textarea`, `Button`, `Select`, `SelectList`, `PhoneInput`, `Datepicker`, `Tooltip`, `Text`, `Logo` and `Breadcrumbs`.

```bash
npx jscodeshift --parser=tsx --extension=js,jsx,ts,tsx -t node_modules/@freenow/wave/lib/cjs/codemods/inverted-to-wrapper.js path/to/src
```

Disclaimer: This codemod wraps every Wave component that is using the `inverted` property with `InvertedColorScheme`, this could lead to a decline in performance in case the
DOM gets too deep. Ideally when you have Wave components using the `inverted` prop with a common parent you wrap the parent instead of each individual component.

### Text weak property

The `weak` property was the initial way to indicate secondary information in a `Text` component, it has been deprecated for a while in favour of
the more semantic `secondary` prop.

```bash
npx jscodeshift --parser=tsx --extension=js,jsx,ts,tsx -t node_modules/@freenow/wave/lib/cjs/codemods/weak-to-secondary.js path/to/src
```

### Tooltip placement property

In a previous minor release we swapped our positioning engine from `react-tether` to `react-popper`, this came with changes in the placement options
of the engine, but to not introduce breaking changes we kept supporting the previous `react-tether` options as well. From now on you need to use the new
`react-popper` options. This change only affects the `Tooltip` component `placement` prop.

```bash
npx jscodeshift --parser=tsx --extension=js,jsx,ts,tsx -t node_modules/@freenow/wave/lib/cjs/codemods/tooltip-placement.js path/to/src
```

You can find the mappings in the following table:

<PlacementMappingsTable />
